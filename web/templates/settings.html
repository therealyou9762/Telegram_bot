{% extends "base.html" %}
{% block title %}Настройки{% endblock %}
{% block content %}
<div class="container py-4">
  <h2 class="mb-4"><i class="bi bi-gear"></i> Настройки пользователя</h2>
  {% if user %}
    <div class="card mb-4">
      <div class="card-body">
        <ul class="list-group list-group-flush mb-3">
          <li class="list-group-item"><strong>ID:</strong> {{ user['id'] }}</li>
          <li class="list-group-item"><strong>Имя:</strong> {{ user['name'] or "—" }}</li>
          <li class="list-group-item"><strong>Email:</strong> {{ user['email'] or "—" }}</li>
        </ul>
        <!-- Форма изменения настроек -->
        <form id="update-setting-form" class="row g-3">
          <div class="col-md-5">
            <label for="field" class="form-label">Поле</label>
            <input type="text" id="field" name="field" class="form-control" placeholder="например, name">
          </div>
          <div class="col-md-5">
            <label for="value" class="form-label">Новое значение</label>
            <input type="text" id="value" name="value" class="form-control" placeholder="Введите новое значение">
          </div>
          <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Сохранить</button>
          </div>
        </form>
      </div>
    </div>
    <script>
      document.getElementById('update-setting-form').onsubmit = async function(e) {
        e.preventDefault();
        const field = e.target.field.value;
        const value = e.target.value.value;
        const response = await fetch("/api/update_setting/{{ user_id }}", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({field, value})
        });
        const data = await response.json();
        alert(data.status === 'success' ? 'Настройки обновлены!' : 'Ошибка: ' + (data.message || ''));
      }
    </script>
  {% else %}
    <div class="alert alert-danger">Пользователь не найден.</div>
  {% endif %}
</div>
{% endblock %}
